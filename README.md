# global-testing-sites# Техническое задание  
на разработку системы функционального тестирования веб-сайтов  
с использованием нейросети для анализа HTML-структуры

---

## 1. Цель и общее описание системы

Цель: создать **масштабируемую систему функционального тестирования веб-сайтов**, которая:

1. Открывает реальные страницы (в т.ч. SPA, JS-heavy) через headless-браузер.
2. **Сканирует структуру сайта (HTML/DOM)** и сохраняет результаты.
3. Передаёт HTML-структуры в **нейросеть**, которая:
   - анализирует DOM/метаданные,
   - **предлагает “точки тестирования”** (критичные элементы, потоки, сценарии),
   - формирует рекомендации по асертам и шагам тестов.
4. Позволяет создавать, хранить и запускать **тесты и ассерты**:
   - вручную (на основе рекомендаций нейросети),
   - полуавтоматически (предзаполнение тестов из рекомендаций).
5. Имеет **панель администрирования** для управления:
   - проектами, окружениями, сканами,
   - тестами, наборами тестов (suites),
   - запуском и результатами.
6. Обеспечивает **запуск тестов по расписанию**:
   - через CLI/скрипты, подключаемые в Cron.
7. Имеет **отдельный проект “Карта тестов / Test Map / Карта мира”**:
   - каталог всех тестов и ассертов,
   - визуализация покрытия сайта,
   - связь тестов с конкретными зонами DOM и точками тестирования.
8. Предусматривает **подключение нейросети**:
   - локальной или внешней (через HTTP/gRPC),
   - с **опциональным использованием прокси-сервера** для доступа к нейросетевому API.

Система должна быть extensible: легко добавлять новые типы тестов, новые модели/провайдеры нейросети, новые источники данных.

---

## 2. Предпочтительный стек технологий

### 2.1. Архитектура

Рекомендуется микросервисный подход (можно стартовать с монолита + отдельных воркеров):

- **Сервис A: Test Runner & Scanner**
- **Сервис B: Test Map (Карта тестов)**
- **Сервис C: API & Admin Backend**
- **Сервис D: AI Assistant / Neural Analyzer** – интеграция с нейросетью
- **Frontend:** Admin Panel UI
- **CLI/скрипты** для Cron

### 2.2. Backend / API

- Язык: **Python 3.11+**
- Web-фреймворк: **FastAPI**
- Асинхронные задачи: **Celery + Redis** (или аналог очередей задач).
- Тест-раннер интегрируется с Playwright.

### 2.3. Headless-браузер и сканер

- **Playwright** (Python):
  - поддержка Chromium/Firefox/WebKit,
  - удобный API для сложных сценариев.

### 2.4. Нейросеть / AI

- Сервис D (**AI Assistant / Neural Analyzer**):
  - Язык: Python (FastAPI или отдельный воркер).
  - Взаимодействие с моделью:
    - либо локальная модель,
    - либо внешний AI-провайдер (HTTP/gRPC).
  - Формат взаимодействия: JSON.
  - Поддержка **настройки прокси** для HTTP-запросов к AI-провайдеру:
    - HTTP(S) proxy, опционально SOCKS5.
    - Настройки на уровне окружения / проекта.

### 2.5. База данных

- Основная БД: **PostgreSQL**
- Кэш/очереди: **Redis**

### 2.6. Admin Panel (Frontend)

- Язык: **TypeScript**
- Framework: **React** (или Vue 3 – по решению команды).
- UI-библиотека: MUI / Ant Design.

### 2.7. Инфраструктура

- **Docker** + `docker-compose`, далее возможен переход на Kubernetes.
- Веб-сервер: **nginx** (reverse-proxy).
- Логи: structured logs (JSON) в stdout + централизованный сбор (опционально).
- Мониторинг: Prometheus + Grafana (опционально).

### 2.8. Интеграция с Cron

- CLI-команды/скрипты:
  - запуск suite’ов,
  - возможность указания проекта/окружения.
- Cron-задания на стороне DevOps.

---

## 3. Основные сущности (модель предметной области)

1. **Project (Проект)**  
   Логическое объединение сайтов и тестов.

2. **Environment (Окружение)**  
   Примеры: `prod`, `staging`, `dev`.  
   Влияет на базовый URL, авторизацию, конфиги AI/прокси.

3. **Target (Сайт / Целевой ресурс)**  
   Домен/поддомен/базовый URL + правила обхода.

4. **Scan Job (Задача сканирования)**  
   Запуск Playwright для обхода сайта и сохранения DOM/метаданных.

5. **Page (Страница)**  
   Конкретный URL, DOM-снимок, статус код, метаданные.

6. **AI Analysis (Результат анализа нейросети)**  
   Для каждой страницы/набора страниц:
   - список “точек тестирования”:
     - важные селекторы,
     - элементы (формы, кнопки “Купить”, шаги воронки),
     - пользовательские потоки (например, “логин”, “чекаут”),
   - предложенные ассерты.

7. **Test Case (Тест)**  
   Структурированный сценарий:
   - шаги (actions),
   - ассерты (assertions),
   - связь с AI-предложениями (опционально).

8. **Test Suite (Набор тестов)**  
   Группа тестов для совместного запуска (smoke, регрессия и т.п.).

9. **Test Run (Запуск теста/набора)**  
   Конкретное выполнение с результатами и артефактами.

10. **Test Map (Карта тестов / Карта мира)**  
    Отдельный проект/сервис:
    - хранит структуру тестов по проектам/окружениям,
    - показывает покрытие сайта тестами,
    - содержит связи “страница → точки тестирования → тесты”.

11. **AI Provider Config (Настройки нейросети)**  
    - тип провайдера (локальная модель, внешний API и т.д.),
    - endpoint,
    - ключи/токены,
    - **параметры прокси (опционально)**.

---

## 4. Архитектура и модули

### 4.1. Сервис A: Scanner & Runner

**Ответственность:**

- Сканирование сайтов (Scan Jobs):
  - запуск Playwright,
  - загрузка страниц, обход ссылок,
  - сохранение DOM/метаданных в БД/хранилище.
- Запуск тестов:
  - получение тестов из Test Map,
  - выполнение шагов,
  - применение ассертов,
  - сохранение результатов Test Run.

**Дополнительно:**

- Взаимодействие с AI-сервисом:
  - по запросу: передать HTML/DOM для анализа,
  - получить JSON с “точками тестирования” и предложенными асертами,
  - сохранить связь “страница ↔ AI-рекомендации”.

### 4.2. Сервис D: AI Assistant / Neural Analyzer

**Функционал:**

1. Принимает запрос от Scanner/Backend:
   - входные данные:
     - HTML/DOM страницы (строка),
     - мета-информация (URL, title, статус, технические данные),
     - опционально: язык сайта, тип страницы (если известен).
2. Вызывает нейросеть (локально или внешне):
   - формирует промпт/структуру запроса,
   - учитывает **настройки прокси**, если указаны:
     - берёт из конфигов окружения/проекта,
     - применяет к HTTP-клиенту.
3. Возвращает структурированный ответ:

```json
{
  "version": "1.0",
  "page_url": "https://example.com/checkout",
  "test_points": [
    {
      "id": "checkout-submit",
      "type": "button",
      "selector": "button[type=submit].checkout-button",
      "description": "Кнопка оформления заказа",
      "recommended_assertions": [
        { "type": "element_exists" },
        { "type": "enabled" },
        { "type": "text_contains", "value": "Оплатить" }
      ]
    },
    {
      "id": "login-form",
      "type": "form",
      "selector": "form#login",
      "description": "Форма логина",
      "flow_hint": "start_auth_flow"
    }
  ],
  "flows": [
    {
      "id": "auth_flow",
      "description": "Авторизация пользователя",
      "steps_suggestion": [
        "goto /login",
        "fill email",
        "fill password",
        "click submit",
        "wait dashboard"
      ]
    }
  ]
}
